# Adapter demo flow
Assuming you run the through the manual setup, you should have the `ADDRESS`, `LINK_TOKEN`, `ORACLE_ADDR` and `TWITTER_JOB_ID` environment variables set.

# Demo

Create a contract with these parameters:

- link: address of link ERC20 token ($LINK_TOKEN)
- deadline: how long before the contract expires (in seconds; for reference, 86400 seconds are 24 hours.)
  when the contract expires with no approval, the originator can get a refund.
- beneficiary: address of receiver of funds when approved. (for example, the 2nd address generated by ganache: 0xFFcf8FDEE72ac11b5c542428B35EEF5769C409f0)
- amount: the amount of ETH that should be transferred to the contract address before it is ready for approval (in wei; 1000000000000000000 is 1 ETH)
- approver_twitter_handle: the twitter handle of the approver
- text: The text the approver needs to tweet for approval
- oracle: the oracle address ($ORACLE_ADDR)
- jobId: the jobId for the twitter verification ($TWITTER_JOB_ID),

For example (adjust handle and approval text):
```bash
export BENEFICIARY=0xFFcf8FDEE72ac11b5c542428B35EEF5769C409f0
# Adjust this to your twitter handle
export APPROVER_HANDLE=KohaviYuval
export APPROVER_TEXT=Yes

npm run build-twitterconsumer
# deploy contract and get its address
node scripts/twitterconsumer/deploy.js $LINK_TOKEN 86400 $BENEFICIARY 1000000000000000000 $APPROVER_HANDLE $APPROVER_TEXT $ORACLE_ADDR $TWITTER_JOB_ID | tee output.txt
DEPLOYED_TC_ADDR=$(grep "contract address:" output.txt | cut -d: -f2 | tr -d ' ')
rm output.txt
# fund contract with link for the oracle
geth attach http://localhost:32000 --jspath ./scripts -exec 'loadScript("fund.js");transfer("'$LINK_TOKEN'", "'$ADDRESS'", "'$DEPLOYED_TC_ADDR'");'

# fund contract with ETH for the beneficiary
node scripts/twitterconsumer/fund.js $DEPLOYED_TC_ADDR 1000000000000000000

# check if the contract is ready (i.e. funded with link and ETH)
node scripts/twitterconsumer/ready.js $DEPLOYED_TC_ADDR 
```

Now go and tweet your approval message. This is the signal that the contract was fulfilled
and should be approved.

Once the tweet is out (it needs to be publicly readable), request contract approval:
```bash
# request approval
node scripts/twitterconsumer/requestApproval.js $DEPLOYED_TC_ADDR 
```

As we use a local test network, we'll need to make some noise on the network so that the transaction is confirmed. move some eth between ganache addresses 8,9 (this is not needed when using a public test network).
```bash
make_noise () {
  geth attach http://localhost:32000 -exec 'eth.sendTransaction({from: "0xACa94ef8bD5ffEE41947b4585a84BdA5a3d3DA6E",to: "0x1dF62f291b2E969fB0849d99D9Ce41e2F137006e", value: "10000000000000000000"})'
  geth attach http://localhost:32000 -exec 'eth.sendTransaction({from: "0x1dF62f291b2E969fB0849d99D9Ce41e2F137006e",to: "0xACa94ef8bD5ffEE41947b4585a84BdA5a3d3DA6E", value: "10000000000000000000"})'
  geth attach http://localhost:32000 -exec 'eth.sendTransaction({from: "0xACa94ef8bD5ffEE41947b4585a84BdA5a3d3DA6E",to: "0x1dF62f291b2E969fB0849d99D9Ce41e2F137006e", value: "10000000000000000000"})'
  geth attach http://localhost:32000 -exec 'eth.sendTransaction({from: "0x1dF62f291b2E969fB0849d99D9Ce41e2F137006e",to: "0xACa94ef8bD5ffEE41947b4585a84BdA5a3d3DA6E", value: "10000000000000000000"})'
}
make_noise
```

You should see the job making progress in the node UI. If it's stuck in the outgoing
confirmation phase, make some more network noise:
```
make_noise
```

You can check that the contract is approved:
```bash
# Check that the contract is approved!
node scripts/twitterconsumer/isapproved.js $DEPLOYED_TC_ADDR
```

Finally, you can withdraw the ETH from the contract to the beneficiary address!
```bash
# withdraw the funds!
node scripts/twitterconsumer/withdraw.js $DEPLOYED_TC_ADDR $BENEFICIARY

# check ETH balance:
geth attach http://localhost:32000 -exec 'eth.getBalance("'$BENEFICIARY'")'
```


# Clean-up
Just run
```bash
kind delete cluster
```